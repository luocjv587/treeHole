<template>
  <div>
    <div id="header" class="full-rotate"><h1>è¿™ä¸ªç½‘ç«™å°†ä¼š</h1><br/>
      <h1>è‡ªæ¯</h1>
      <h3>(åœ¨ {{countDownSecond}} ç§’ä¹‹å)</h3></div>
    <div id="message" class="note full-rotate border border-primary">
      <div v-if="letterInfo===''">
        <p>Hi,</p>
        <p>æˆ‘æ˜¯ä¸€ä¸ªç½‘ç«™ã€‚æˆ‘å¾ˆå¿«å°±ä¼šç¦»å¼€ï¼Œè¿™æ²¡å…³ç³»ã€‚</p>
        <p>ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¡¨æ ¼ç»™æˆ‘å‘æ¶ˆæ¯ã€‚ å¦‚æœæˆ‘24å°æ—¶æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œæˆ‘å°±ä¼šæ°¸ä¹…è‡ªæ¯ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½ä¼šä»æˆ‘çš„æ•°æ®åº“ä¸­åˆ é™¤ã€‚</p>
        <p>ä¸è¿‡æ²¡å…³ç³»ã€‚</p>
        <p>åœ¨é‚£ä¹‹å‰ï¼Œè®©æˆ‘çŸ¥é“ä½ æ˜¯å¦‚ä½•åšçš„ã€‚å…¶ä»–äººå°†èƒ½å¤Ÿè¯»åˆ°ä½ å†™çš„ä¸œè¥¿ï¼Œä½†ä½ çš„åå­—æˆ–èº«ä»½ä¸ä¼šè¢«é™„åŠ åˆ°ä»»ä½•ä¸œè¥¿ä¸Šï¼Œæ‰€ä»¥è¯·éšæ„è¯´å‡ºä½ çš„æƒ³æ³•ã€‚</p>
        <p>è¿™æ˜¯ä¸€ä¸ªè‰°éš¾çš„å‡ ä¸ªæœˆã€‚</p>
        <p>With love,</p>
        <p>treeHole(dot)site</p>
        <p>P.S. æˆ‘ç›¸ä¿¡ä¸€ä¸ªæ²¡æœ‰å…¥ä¾µæ€§å¹¿å‘Šå’Œåœ¨çº¿è·Ÿè¸ªçš„äº’è”ç½‘ã€‚</p>
      </div>
      <div style="white-space: pre-wrap;" v-else><p>{{this.letterInfo}}</p></div>
    </div>
    <div v-if="openFeelingDown" id="feeling-down" class="note full-rotate border"><p>ä¸€åˆ‡éƒ½å¥½å—ï¼Ÿ</p>
      <p>å¦‚æœä½ æˆ–ä½ è®¤è¯†çš„äººæ­£åœ¨æŒ£æ‰ï¼Œä½ å¹¶ä¸å­¤å•ã€‚è¿™é‡Œæœ‰è®¸å¤šæ”¯æŒæœåŠ¡å¯ä»¥æä¾›å¸®åŠ©ã€‚ </p>
      <p>å¦‚æœæ‚¨åœ¨ç¾å›½ï¼Œè¯·è€ƒè™‘è”ç³»<a href="https://www.nami.org/help">å›½å®¶å®‰å…¨å±€
        ç²¾ç¥ç–¾ç—…è”ç›Ÿå¸®åŠ©çƒ­çº¿</a>ã€‚</p>
      <p>å¦‚æœæ‚¨åœ¨è‹±å›½ï¼Œ<a href="https://www.themix.org.uk/get-support">The Mix</a>åœ¨è¿™é‡Œã€‚
        æ¥å¸®åŠ©æ‚¨è§£å†³æ‚¨æ‰€é¢ä¸´çš„ä»»ä½•æŒ‘æˆ˜ã€‚è¯·åœ¨ç½‘ä¸Šã€ç¤¾äº¤åª’ä½“ä¸Šæˆ–é€šè¿‡ä»–ä»¬çš„å…è´¹å’Œ
        ä¿å¯†å¸®åŠ©çƒ­çº¿ï¼š</p>
      <p>å¦‚æœæ‚¨åœ¨æ¬§æ´²å…¶ä»–å›½å®¶è¯»åˆ°è¿™ç¯‡æ–‡ç« ï¼Œ<a href="https://mhe-sme.org/library/youth-helplines/">æ¬§æ´²å¿ƒç†å¥åº·</a>å·²ç¼–åˆ¶äº†è´µå›½çš„å¸®åŠ©çƒ­çº¿å’Œå…¶ä»–èµ„æºæ¸…å•ã€‚</p>
      <p>æ›´å¤šçš„èµ„æºï¼Œè¯·è®¿é—®è¿™ä¸ª<a href="http://www.tumblr.com/docs/en/counseling_prevention_resources">å¿ƒç†å’¨è¯¢ é¢„é˜²èµ„æº</a>é¡µé¢ï¼Œä»¥è·å–å¯èƒ½æä¾›å¸®åŠ©çš„æœåŠ¡åˆ—è¡¨ã€‚
      </p>
    </div>


    <div id="message-controls" class="note full-rotate border center">
      <button @click="getLetter">é˜…è¯»ä¸€ä»½æ¶ˆæ¯</button>
      <button @click="like">ğŸ’–</button>
      <button v-if="!openFeelingDown" @click="openFeelingDown=true">æ„Ÿåˆ°æ²®ä¸§?</button>
    </div>
    <div id="letter" class="note full-rotate border" v-if="openSend">
      <form><textarea id="letter-textarea" rows="" placeholder="" class="textarea" v-model="sendLetterInfo"></textarea>
        <div class="flex">
          <button type="button" class="right" @click="sendLetter">å‘é€</button>
        </div>
      </form>
    </div>
    <div id="music player"></div>
    <div id="share" class="note full-rotate border center"><p>æˆ‘å·²ç»å‘†äº† {{existsTimeArr.year}} å¹´, {{existsTimeArr.month}} æœˆ,
      {{existsTimeArr.day}} æ—¥, {{existsTimeArr.hour}} å°æ—¶, {{existsTimeArr.minute}} åˆ†é’Ÿ,
      å’Œ {{existsTimeArr.second}} ç§’.</p>
      <p>è¯·è€ƒè™‘æŠŠæˆ‘åˆ†äº«ç»™æœ‹å‹ä»¬ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åœ¨è¿™é‡Œå¤šå‘†ä¸€ä¼šå„¿ã€‚</p>
      <!--      <a-->
      <!--        href="mailto:?subject=This Website Will Selfdestruct&amp;body=Check out ThisWebsiteWillSelfdestruct.com.  If nobody sends a message, it will go away."-->
      <!--        class="paper-btn share-btn email">-->
      <!--        Email-->
      <!--      </a>-->
    </div>
    <div id="footer" class="note full-rotate border center"><p>A site by <a href="">@Luo</a>
    </p>
      <p><a href="privacy">éšç§æ”¿ç­–</a></p></div>

    <div id="source" class="note full-rotate border center">
      <p><a href="https://www.thiswebsitewillselfdestruct.com/">åˆ›æ„æ¥æº</a></p></div>
  </div>
</template>

<script>
  import axios from "axios";
  export default {
    name: 'HelloWorld',
    data() {
      return {
        backUrl: process.env.VUE_APP_BACK_URL,
        countDownSecond: 80000,
        startTime: "2020-07-14",
        existsTimeArr: {
          year: 0,
          month: 0,
          day: 0,
          hour: 0,
          minute: 0,
          second: 0,
        },
        openFeelingDown: false,
        letterInfo: "",
        sendLetterInfo: "Hi, \n",
        openSend: true,
        currentLetterId: 1,
      }
    },
    created() {
      console.log(9, process.env);
      this.countDown();
      this.existTime();
      this.getSeconds();
    },

    methods: {
      //è·å–æ¯ç­å€’è®¡æ—¶
      countDown() {
        let interval = setInterval(() => {
          if (this.countDownSecond <= 0) {
            clearInterval(interval);
          }
          this.countDownSecond -= 1;
        }, 1000);
      },
      //è·å–å­˜åœ¨æ—¶é—´
      existTime() {
        setInterval(() => {
          let startTime = this.startTime
          let s1 = new Date(startTime.replace(/-/g, "/")),
            s2 = new Date(),
            runTime = parseInt((s2.getTime() - s1.getTime()) / 1000);
          let year = Math.floor(runTime / 86400 / 365);
          runTime = runTime % (86400 * 365);
          let month = Math.floor(runTime / 86400 / 30);
          runTime = runTime % (86400 * 30);
          let day = Math.floor(runTime / 86400);
          runTime = runTime % 86400;
          let hour = Math.floor(runTime / 3600);
          runTime = runTime % 3600;
          let minute = Math.floor(runTime / 60);
          runTime = runTime % 60;
          let second = runTime;

          this.existsTimeArr.year = year;
          this.existsTimeArr.month = month;
          this.existsTimeArr.day = day;
          this.existsTimeArr.hour = hour;
          this.existsTimeArr.minute = minute;
          this.existsTimeArr.second = second;
        }, 1000);
      },
      feelingDown() {
        this.openFeelingDown = true
      },
      //è·å–å€’è®¡æ—¶
      async getSeconds() {
        let result = await axios.get(this.backUrl + '/getSecond')
        this.countDownSecond = result.data.data.seconds
      },
      //è·å–ä¸€å°ä¿¡
      async getLetter() {
        let result = await axios.get(this.backUrl + '/getLetter')
        console.log(result.data.data.letter_info)
        this.letterInfo = result.data.data.letter_info
        this.currentLetterId = result.data.data.id
        window.scrollTo(0, 0)
      },
      //å‘é€ä¸€å°ä¿¡
      async sendLetter() {
        await axios.post(this.backUrl + '/createLetter', {
          letter_info: this.sendLetterInfo,
        })
        this.openSend = false

      },
      //å–œçˆ±
      async like() {
        let result = await axios.post(this.backUrl + '/likeLetter', {
          letter_id: this.currentLetterId
        })
      }
    },
  }
</script>

